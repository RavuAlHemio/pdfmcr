(()=>{var e,t,n,l;let i="http://www.w3.org/2000/svg";function a(e,t){let n=e.ownerSVGElement;if(null===n)return null;let l=e.transform.baseVal;if(1!==l.length)return null;let i=l.getItem(0);if(i.type!==SVGTransform.SVG_TRANSFORM_TRANSLATE)return null;let a=n.createSVGLength();a.newValueSpecifiedUnits(SVGLength.SVG_LENGTHTYPE_NUMBER,i.matrix.e),a.convertToSpecifiedUnits(t);let r=a.valueInSpecifiedUnits;return a.newValueSpecifiedUnits(SVGLength.SVG_LENGTHTYPE_NUMBER,i.matrix.f),a.convertToSpecifiedUnits(t),{x:r,y:a.valueInSpecifiedUnits}}function r(e){let t=null;for(let n of e.children)if(n.namespaceURI===i&&"image"===n.tagName){t=n;break}return null===t?null:(t.height.baseVal.convertToSpecifiedUnits(SVGLength.SVG_LENGTHTYPE_PT),t.height.baseVal.valueInSpecifiedUnits)}!function(e){let t=null,n=[];function l(e,n,l){if(null===t)return null;let i=e.ownerSVGElement;if(null===i)return null;let a=i.createSVGTransform();return a.setTranslate(t.x+n,t.y+l),e.transform.baseVal.initialize(a),i}function o(e,r,o){let u=e.ownerSVGElement;if(null===u)return null;let s=u.createSVGLength();s.newValueSpecifiedUnits(SVGLength.SVG_LENGTHTYPE_PT,o.left),s.convertToSpecifiedUnits(SVGLength.SVG_LENGTHTYPE_NUMBER);let c=s.valueInSpecifiedUnits;s.newValueSpecifiedUnits(SVGLength.SVG_LENGTHTYPE_PT,r-o.bottom),s.convertToSpecifiedUnits(SVGLength.SVG_LENGTHTYPE_NUMBER);let f=s.valueInSpecifiedUnits,d=document.createElementNS(i,"g");d.classList.add("annotation");let g=u.createSVGTransform();g.setTranslate(c,f),d.transform.baseVal.initialize(g);let p=document.createElementNS(i,"rect");p.x.baseVal.newValueSpecifiedUnits(SVGLength.SVG_LENGTHTYPE_PT,0),p.y.baseVal.newValueSpecifiedUnits(SVGLength.SVG_LENGTHTYPE_PT,0),p.width.baseVal.newValueSpecifiedUnits(SVGLength.SVG_LENGTHTYPE_PT,10),p.height.baseVal.newValueSpecifiedUnits(SVGLength.SVG_LENGTHTYPE_PT,10),p.style.fill="#fff",p.style.fillOpacity="0.5",p.addEventListener("mousedown",e=>(function(e,i){if(0!==i.button)return;i.stopPropagation();let r=e.ownerSVGElement;if(null===r)return;let o=a(e,SVGLength.SVG_LENGTHTYPE_NUMBER);if(null===o)return;t={x:o.x-i.clientX,y:o.y-i.clientY};let u=t=>{l(e,t.clientX,t.clientY)};n.push(["mousemove",u]),r.addEventListener("mousemove",u);let s=i=>(function(e,i){if(0!==i.button)return;let a=l(e,i.clientX,i.clientY);if(null!==a){for(let e of n.splice(0,n.length))a.removeEventListener(e[0],e[1]);t=null}})(e,i);n.push(["mouseup",s]),r.addEventListener("mouseup",s)})(d,e)),d.appendChild(p);let m=document.createElementNS(i,"text");for(let e of(m.style.fill="#000",d.appendChild(m),o.elements)){let t=e.font_size+e.leading,n=document.createElementNS(i,"tspan");n.style.fontSize=`${e.font_size}pt`,n.style.letterSpacing=`${e.character_spacing}pt`,n.style.wordSpacing=`${e.word_spacing}pt`,n.style.lineHeight=`${t}pt`,m.appendChild(n),null!==e.language&&n.setAttribute("data-language",e.language),null!==e.alternate_text&&n.setAttribute("data-alternate-text",e.alternate_text),null!==e.actual_text&&n.setAttribute("data-actual-text",e.actual_text),null!==e.expansion&&n.setAttribute("data-expansion",e.expansion);let l=document.createTextNode(e.text);n.appendChild(l)}return e.appendChild(d),d}e.init=function(e){void 0===e&&(e={annotations:[],artifacts:[]}),document.addEventListener("DOMContentLoaded",()=>{!function(e){let t=document.getElementById("pdfmcr-page-group");if(null===t)return;let n=r(t);if(null!==n)for(let l of e.annotations)o(t,n,l)}(e),function(){let e=document.getElementById("pdfmcr-new-annotation-form");if(null===e)return;let t=e.querySelector("input[type=text]");null!==t&&e.addEventListener("submit",e=>(function(e,t){t.preventDefault();let n=e.value,l=document.getElementById("pdfmcr-page-group");if(null===l)return;let i=r(l);null!==i&&o(l,i,{left:0,bottom:0,elements:[{text:n,font_variant:"Regular",font_size:12,character_spacing:0,word_spacing:0,leading:0,language:null,alternate_text:null,actual_text:null,expansion:null}]})})(t,e))}()})}}(e||(e={})),function(e){function t(e){return e.endsWith("pt")?+e.substring(0,e.length-2):null}function n(e,n){if(null===e.ownerSVGElement)return null;let l=a(e,SVGLength.SVG_LENGTHTYPE_PT);if(null===l)return null;let r=e.getElementsByTagNameNS(i,"text");if(0===r.length)return null;let o=r[0],u=[];for(let e of o.children){if(e.namespaceURI!==i||"tspan"!==e.localName)continue;let n=t(e.style.fontSize),l=t(e.style.letterSpacing),a=t(e.style.wordSpacing),r=t(e.style.lineHeight),o="bold"===e.style.fontWeight,s="italic"===e.style.fontStyle;if(null===n||null===l||null===a||null===r)continue;let c=r-n,f=e.childNodes;if(1!==f.length||f[0].nodeType!==Node.TEXT_NODE)return null;let d=f[0].textContent;if(null===d)return null;let g=o?s?"BoldItalic":"Bold":s?"Italic":"Regular";u.push({text:d,font_variant:g,font_size:Math.round(n),character_spacing:Math.round(l),word_spacing:Math.round(a),leading:Math.round(c),language:null,alternate_text:null,actual_text:null,expansion:null})}return{left:Math.round(l.x),bottom:Math.round(n-l.y),elements:u}}function l(e){let t={annotations:[],artifacts:[]},l=r(e);for(let a of e.children)if(a.namespaceURI===i&&"g"===a.localName){if(a.classList.contains("annotation")){if(null===l)continue;let e=n(a,l);if(null===e)continue;t.annotations.push(e)}else if(a.classList.contains("artifact")){if(null===l)continue;let e=null;if(a.classList.contains("background"))e="Background";else if(a.classList.contains("layout"))e="Layout";else if(a.classList.contains("page"))e="Page";else{if(!a.classList.contains("pagination"))continue;e="Pagination"}let i=n(a,l);if(null===i)continue;t.artifacts.push({kind:e,annotation:i})}}return t}async function o(){let e=document.getElementById("pdfmcr-page-group");if(null===e)return void alert("cannot save: page group not found");let t=document.querySelector('meta[name="pdfmcr-page-number"]');if(null===t)return void alert("cannot save: page number meta element not found");let n=+t.content,i=new Request(`/page/${n}/annotations`,{method:"POST",body:JSON.stringify(l(e)),headers:{"Content-Type":"application/json"}}),a=!1;try{let e=await fetch(i),t=e.text();200!==e.status?alert("cannot save: "+t):a=!0}catch(e){alert("cannot save: "+await e)}a&&alert("saved!")}function u(){let e=document.getElementById("pdfmcr-save");null!==e&&e.addEventListener("click",o)}e.serialize=l,e.init=function(){document.addEventListener("DOMContentLoaded",u)}}(t||(t={}));class o{constructor(e,t){this.key=e,this.value=t}getKey(){return this.key}getValue(){return this.value}}let u=Symbol();class s{constructor(){this.entries=[]}getIndexForKey(e){for(let t=0;t<this.entries.length;t++)if(this.entries[t].getKey()===e)return t;return null}set(e,t){let n=this.getIndexForKey(e);if(null!==n){let e=this.entries[n].getValue();return this.entries[n]=new o(this.entries[n].getKey(),t),e}return this.entries.push(new o(e,t)),u}get(e){let t=this.getIndexForKey(e);return null!==t?this.entries[t].getValue():u}remove(e){let t=this.getIndexForKey(e);return null!==t?this.entries.splice(t,1)[0].getValue():u}length(){return this.entries.length}keys(){let e=[];for(let t=0;t<this.entries.length;t++)e.push(this.entries[t].getKey());return e}}"use strict";!function(e){let t=[],n=new s;function l(){for(let e of document.getElementsByClassName("spl-splitter-container")){for(let t of e.getElementsByClassName("spl-pane"))t.style.flexGrow="1",t.style.flexShrink="1",t.style.flexBasis="auto",t.style.overflow="hidden";for(let l of e.getElementsByClassName("spl-splitter"))l.style.width="8px",l.style.height="100%",l.style.cursor="col-resize",l.style.userSelect="none",l.addEventListener("mousedown",e=>(function(e,l){let i=e.previousElementSibling,a=e.nextElementSibling;if(null===i||null===a)return;n.set(e,{startPosition:{x:l.clientX,y:l.clientY},splitterLeft:e.offsetLeft,splitterTop:e.offsetTop,leftPaneWidth:i.offsetWidth,rightPaneWidth:a.offsetWidth});let r=t=>(function(e,t){let l=n.get(e);if(l===u)return;let i=e.previousElementSibling,a=e.nextElementSibling;if(null===i||null===a)return;let r={x:t.clientX-l.startPosition.x,y:t.clientY-l.startPosition.y};r.x<-l.leftPaneWidth&&(r.x=-l.leftPaneWidth),r.x>l.rightPaneWidth&&(r.x=l.rightPaneWidth),e.style.left=`${l.splitterLeft+r.x}px`,i.style.width=`${l.leftPaneWidth+r.x}px`,a.style.width=`${l.rightPaneWidth-r.x}px`})(e,t);document.addEventListener("mousemove",r),t.push(["mousemove",r]);let o=()=>(function(){let e=t.splice(0,t.length);for(let t=0;t<e.length;t++)document.removeEventListener(e[t][0],e[t][1])})();document.addEventListener("mouseup",o),t.push(["mouseup",o])})(l,e))}}e.init=function(){document.addEventListener("DOMContentLoaded",l)}}(n||(n={})),function(e){let t=null,n={x:0,y:0},l=[];function i(e){let t=e.ownerSVGElement;if(null===t)return;let l=t.createSVGTransform();l.setTranslate(n.x,n.y),e.transform.baseVal.initialize(l)}function a(e,t,n){e.addEventListener(t,n),l.push([t,n])}function r(){let e=document.getElementById("pdfmcr-page-group");if(null===e)return;e.addEventListener("mousedown",r=>(function(e,r){if(0!==r.button)return;let o=e.ownerSVGElement;null!==o&&(t={x:r.offsetX-n.x,y:r.offsetY-n.y},a(o,"mousemove",l=>{null!==t&&(n={x:l.clientX-t.x,y:l.clientY-t.y},i(e))}),a(o,"mouseup",i=>(function(e,i){if(0!==i.button||null===t)return;let a=e.ownerSVGElement;if(null!==a)for(let e of(n={x:i.clientX-t.x,y:i.clientY-t.y},t=null,l.splice(0,l.length)))a.removeEventListener(e[0],e[1])})(e,i)))})(e,r));let r=document.getElementById("pdfmcr-reset-view");null!==r&&r.addEventListener("click",()=>{n={x:0,y:0},i(e)})}e.init=function(){document.addEventListener("DOMContentLoaded",r)}}(l||(l={})),window.PdfMcr={Annotations:e,Serialize:t,Splitter:n,SvgDrag:l,init:function(){window.PdfMcr.Serialize.init(),window.PdfMcr.Splitter.init(),window.PdfMcr.SvgDrag.init()}}})();
//# sourceMappingURL=main.js.map
