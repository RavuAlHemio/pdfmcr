(()=>{var e,t,n,l,a;let i="http://www.w3.org/2000/svg";function u(e,t){let n=e.ownerSVGElement;if(null===n)return null;let l=e.transform.baseVal;if(1!==l.length)return null;let a=l.getItem(0);if(a.type!==SVGTransform.SVG_TRANSFORM_TRANSLATE)return null;let i=n.createSVGLength();i.newValueSpecifiedUnits(SVGLength.SVG_LENGTHTYPE_NUMBER,a.matrix.e),i.convertToSpecifiedUnits(t);let u=i.valueInSpecifiedUnits;return i.newValueSpecifiedUnits(SVGLength.SVG_LENGTHTYPE_NUMBER,a.matrix.f),i.convertToSpecifiedUnits(t),{x:u,y:i.valueInSpecifiedUnits}}function o(e){let t=null;for(let n of e.children)if(n.namespaceURI===i&&"image"===n.tagName){t=n;break}return null===t?null:(t.height.baseVal.convertToSpecifiedUnits(SVGLength.SVG_LENGTHTYPE_PT),t.height.baseVal.valueInSpecifiedUnits)}function r(e,t,n){let l=e.children,a=[];for(let e=0;e<l.length;e++){let i=l[e];i.namespaceURI===t&&i.localName===n&&a.push(i)}return a}function c(e){return e.endsWith("pt")?+e.substring(0,e.length-2):null}!function(e){let t=null;e.currentImageScale=1;let n={x:0,y:0},l=[];function a(t){let l=t.ownerSVGElement;if(null===l)return;let a=l.createSVGTransform();a.setScale(e.currentImageScale,e.currentImageScale);let i=l.createSVGTransform();i.setTranslate(n.x,n.y),t.transform.baseVal.initialize(a),t.transform.baseVal.appendItem(i)}function i(t,n){e.currentImageScale*=n,a(t)}function u(e,t,n){e.addEventListener(t,n),l.push([t,n])}function o(){let o=document.getElementById("pdfmcr-page-group");if(null===o)return;o.addEventListener("mousedown",i=>(function(i,o){if(0!==o.button)return;let r=i.ownerSVGElement;null!==r&&(t={x:o.offsetX-n.x*e.currentImageScale,y:o.offsetY-n.y*e.currentImageScale},u(r,"mousemove",l=>{null!==t&&(n={x:(l.clientX-t.x)/e.currentImageScale,y:(l.clientY-t.y)/e.currentImageScale},a(i))}),u(r,"mouseup",u=>(function(i,u){if(0!==u.button||null===t)return;let o=i.ownerSVGElement;if(null!==o){for(let a of(n={x:(u.clientX-t.x)/e.currentImageScale,y:(u.clientY-t.y)/e.currentImageScale},t=null,l.splice(0,l.length)))o.removeEventListener(a[0],a[1]);a(i)}})(i,u)))})(o,i));let r=document.getElementById("pdfmcr-zoom-in-button");null!==r&&r.addEventListener("click",()=>i(o,1.5));let c=document.getElementById("pdfmcr-zoom-out-button");null!==c&&c.addEventListener("click",()=>i(o,2/3));let s=document.getElementById("pdfmcr-reset-view-button");null!==s&&s.addEventListener("click",()=>{n={x:0,y:0},e.currentImageScale=1,a(o)})}e.init=function(){document.addEventListener("DOMContentLoaded",o)}}(e||(e={})),function(e){let t=null,l=null,a=null;function u(){if(null===t||null===l)return;let e=r(l,i,"tspan"),n=t.textSpanSelect.selectedIndex;a=-1===n||n>=e.length?null:e[n];let u=0,o=c(l.style.lineHeight),s=c(l.style.fontSize)??12;null!==o&&(u=o-s),t.leadingInput.value=""+u,t.fontSizeInput.value=""+(c(l.style.fontSize)??12),null!==a&&(t.textArea.value=a.textContent??"",t.fontBoldCheckbox.checked="bold"===a.style.fontWeight,t.fontItalicCheckbox.checked="italic"===a.style.fontStyle,t.charSpacingInput.value=""+(c(a.style.letterSpacing)??0),t.wordSpacingInput.value=""+(c(a.style.wordSpacing)??0),t.leadingInput.value=""+u,t.languageEnabledCheckbox.checked=a.hasAttribute("data-lang"),t.languageInput.value=a.getAttribute("data-lang")??"",t.altTextEnabledCheckbox.checked=a.hasAttribute("data-alt-text"),t.altTextInput.value=a.getAttribute("data-alt-text")??"",t.actualTextEnabledCheckbox.checked=a.hasAttribute("data-actual-text"),t.actualTextInput.value=a.getAttribute("data-actual-text")??"",t.expansionEnabledCheckbox.checked=a.hasAttribute("data-expansion"),t.expansionTextInput.value=a.getAttribute("data-expansion")??"")}function o(e){return e.length>80?e.substring(0,80)+"â€¦":e}function s(){let e;if(null===t||null===l)return;if(null!==a){for(let t of(e=document.createElementNS(a.namespaceURI,a.localName),a.attributes))e.setAttributeNS(t.namespaceURI,t.name,t.value);l.appendChild(e)}else{let t=n.createDefaultTextChunk("lorem ipsum");e=n.makeTSpanFromTextChunk(l,t)}let i=document.createElement("option");i.text=o(e.textContent??""),t.textSpanSelect.appendChild(i),t.textSpanSelect.selectedIndex=t.textSpanSelect.options.length-1}function d(){if(null===t||null===l||-1===t.textSpanSelect.selectedIndex)return;let e=r(l,i,"tspan");if(t.textSpanSelect.selectedIndex>=e.length)return;let n=e[t.textSpanSelect.selectedIndex];null!==n.parentElement&&n.parentElement.removeChild(n),t.textSpanSelect.options.remove(t.textSpanSelect.selectedIndex)}function f(){if(null===t||null===l||null===a)return;let e=+t.leadingInput.value+ +t.fontSizeInput.value;for(let[n,i,u]of(l.style.fontSize=`${t.fontSizeInput.value}pt`,l.style.lineHeight=`${e}pt`,a.textContent=t.textArea.value,a.style.fontWeight=t.fontBoldCheckbox.checked?"bold":"",a.style.fontStyle=t.fontItalicCheckbox.checked?"italic":"",a.style.letterSpacing=`${t.charSpacingInput.value}pt`,a.style.wordSpacing=`${t.wordSpacingInput.value}pt`,[[t.languageEnabledCheckbox,t.languageInput,"data-lang"],[t.altTextEnabledCheckbox,t.altTextInput,"data-alt-text"],[t.actualTextEnabledCheckbox,t.actualTextInput,"data-actual-text"],[t.expansionEnabledCheckbox,t.expansionTextInput,"data-expansion"]]))n.checked?a.setAttribute(u,i.value):a.removeAttribute(u);-1!==t.textSpanSelect.selectedIndex&&(t.textSpanSelect.options[t.textSpanSelect.selectedIndex].text=o(a.textContent))}function p(){let e=document.getElementById("pdfmcr-edit-label"),n=document.getElementById("pdfmcr-font-size"),l=document.getElementById("pdfmcr-leading"),a=document.getElementById("pdfmcr-tspan-select"),i=document.getElementById("pdfmcr-textarea"),o=document.getElementById("pdfmcr-font-bold-checkbox"),r=document.getElementById("pdfmcr-font-italic-checkbox"),c=document.getElementById("pdfmcr-char-spacing"),p=document.getElementById("pdfmcr-word-spacing"),m=document.getElementById("pdfmcr-lang-enabled"),g=document.getElementById("pdfmcr-lang"),S=document.getElementById("pdfmcr-alt-text-enabled"),x=document.getElementById("pdfmcr-alt-text"),h=document.getElementById("pdfmcr-actual-text-enabled"),E=document.getElementById("pdfmcr-actual-text"),y=document.getElementById("pdfmcr-expansion-enabled"),b=document.getElementById("pdfmcr-expansion");if(null===e||null===n||null===l||null===a||null===i||null===o||null===r||null===c||null===p||null===m||null===g||null===S||null===x||null===h||null===E||null===y||null===b)return;let I=document.getElementById("pdfmcr-add-tspan-button"),v=document.getElementById("pdfmcr-remove-tspan-button"),T=document.getElementById("pdfmcr-update-tspan-button");null!==I&&null!==v&&null!==T&&(t={editLabelSection:e,fontSizeInput:n,leadingInput:l,textSpanSelect:a,textArea:i,fontBoldCheckbox:o,fontItalicCheckbox:r,charSpacingInput:c,wordSpacingInput:p,languageEnabledCheckbox:m,languageInput:g,altTextEnabledCheckbox:S,altTextInput:x,actualTextEnabledCheckbox:h,actualTextInput:E,expansionEnabledCheckbox:y,expansionTextInput:b},a.addEventListener("change",u),I.addEventListener("click",s),v.addEventListener("click",d),T.addEventListener("click",f))}e.textSelected=function(e){if(null!==t){for(l=e;t.textSpanSelect.options.length>0;)t.textSpanSelect.options.remove(t.textSpanSelect.options.length-1);for(let e of r(l,i,"tspan")){let n=document.createElement("option");n.textContent=o(e.textContent??""),t.textSpanSelect.appendChild(n)}t.textSpanSelect.selectedIndex=0,u(),t.editLabelSection.style.display=""}},e.textDeselected=function(){null!==t&&(t.editLabelSection.style.display="none",l=null,a=null)},e.init=function(){document.addEventListener("DOMContentLoaded",p)}}(t||(t={})),function(n){let l=null,a=[],r=null;function c(t,n,a){if(null===l)return null;let i=t.ownerSVGElement;if(null===i)return null;let u=i.createSVGTransform();return u.setTranslate((n-l.x)/e.currentImageScale,(a-l.y)/e.currentImageScale),t.transform.baseVal.initialize(u),i}function s(e){return{text:e,font_variant:"Regular",character_spacing:0,word_spacing:0,language:null,alternate_text:null,actual_text:null,expansion:null}}function d(e,t){let n=document.createElementNS(i,"tspan");n.style.letterSpacing=`${t.character_spacing}pt`,n.style.wordSpacing=`${t.word_spacing}pt`,n.style.whiteSpace="pre",e.appendChild(n),null!==t.language&&n.setAttribute("data-language",t.language),null!==t.alternate_text&&n.setAttribute("data-alternate-text",t.alternate_text),null!==t.actual_text&&n.setAttribute("data-actual-text",t.actual_text),null!==t.expansion&&n.setAttribute("data-expansion",t.expansion);let l=document.createTextNode(t.text);return n.appendChild(l),n}function f(n,o,s){let f=n.ownerSVGElement;if(null===f)return null;let p=f.createSVGLength();p.newValueSpecifiedUnits(SVGLength.SVG_LENGTHTYPE_PT,s.left),p.convertToSpecifiedUnits(SVGLength.SVG_LENGTHTYPE_NUMBER);let m=p.valueInSpecifiedUnits;p.newValueSpecifiedUnits(SVGLength.SVG_LENGTHTYPE_PT,o-s.bottom),p.convertToSpecifiedUnits(SVGLength.SVG_LENGTHTYPE_NUMBER);let g=p.valueInSpecifiedUnits,S=document.createElementNS(i,"g");S.classList.add("annotation");let x=f.createSVGTransform();x.setTranslate(m,g),S.transform.baseVal.initialize(x);let h=s.font_size+s.leading,E=document.createElementNS(i,"text");for(let e of(E.style.fill="#000",E.style.fontSize=`${s.font_size}pt`,E.style.lineHeight=`${h}pt`,S.appendChild(E),s.elements))d(E,e);let y=document.createElementNS(i,"rect");return y.x.baseVal.newValueSpecifiedUnits(SVGLength.SVG_LENGTHTYPE_PT,0),y.y.baseVal.newValueSpecifiedUnits(SVGLength.SVG_LENGTHTYPE_PT,0),y.width.baseVal.newValueSpecifiedUnits(SVGLength.SVG_LENGTHTYPE_PT,10),y.height.baseVal.newValueSpecifiedUnits(SVGLength.SVG_LENGTHTYPE_PT,10),y.style.fill="#fff",y.style.fillOpacity="0.5",y.addEventListener("mousedown",n=>(function(n,o,s){if(0!==s.button)return;s.stopPropagation(),null!==r&&(r.style.fill="#fff"),r=n,n.style.fill="#f00";let d=o.getElementsByTagNameNS(i,"text");d.length>0&&t.textSelected(d[0]);let f=o.ownerSVGElement;if(null===f)return;let p=u(o,SVGLength.SVG_LENGTHTYPE_NUMBER);if(null===p)return;l={x:s.offsetX-p.x*e.currentImageScale,y:s.offsetY-p.y*e.currentImageScale};let m=e=>{c(o,e.clientX,e.clientY)};a.push(["mousemove",m]),f.addEventListener("mousemove",m);let g=e=>(function(e,t){if(0!==t.button)return;let n=c(e,t.clientX,t.clientY);if(null!==n){for(let e of a.splice(0,a.length))n.removeEventListener(e[0],e[1]);l=null}})(o,e);a.push(["mouseup",g]),f.addEventListener("mouseup",g)})(y,S,n)),S.appendChild(y),n.appendChild(S),S}n.createDefaultTextChunk=s,n.makeTSpanFromTextChunk=d,n.init=function(e){void 0===e&&(e={annotations:[],artifacts:[]}),document.addEventListener("DOMContentLoaded",()=>{!function(e){let t=document.getElementById("pdfmcr-page-group");if(null===t)return;let n=o(t);if(null!==n)for(let l of e.annotations)f(t,n,l)}(e),function(){let e=document.getElementById("pdfmcr-new-annotation-form");if(null===e)return;let t=e.querySelector("input[type=text]");null!==t&&e.addEventListener("submit",e=>(function(e,t){t.preventDefault();let n=e.value,l=document.getElementById("pdfmcr-page-group");if(null===l)return;let a=o(l);null!==a&&f(l,a,{left:0,bottom:0,font_size:12,leading:0,elements:[s(n)]})})(t,e))}()})}}(n||(n={})),function(e){function t(e,t){if(null===e.ownerSVGElement)return null;let n=u(e,SVGLength.SVG_LENGTHTYPE_PT);if(null===n)return null;let l=e.getElementsByTagNameNS(i,"text");if(0===l.length)return null;let a=l[0],o=c(a.style.fontSize),r=c(a.style.lineHeight);if(null===o||null===r)return null;let s=[];for(let e of a.children){if(e.namespaceURI!==i||"tspan"!==e.localName)continue;let t=c(e.style.letterSpacing),n=c(e.style.wordSpacing),l="bold"===e.style.fontWeight,a="italic"===e.style.fontStyle;if(null===t||null===n)continue;let u=e.childNodes;if(1!==u.length||u[0].nodeType!==Node.TEXT_NODE)return null;let o=u[0].textContent;if(null===o)return null;let r=l?a?"BoldItalic":"Bold":a?"Italic":"Regular",d=e.getAttribute("data-lang"),f=e.getAttribute("data-alt-text"),p=e.getAttribute("data-actual-text"),m=e.getAttribute("data-expansion");s.push({text:o,font_variant:r,character_spacing:t,word_spacing:n,language:d,alternate_text:f,actual_text:p,expansion:m})}return{left:Math.round(n.x),bottom:Math.round(t-n.y),font_size:o,leading:r-o,elements:s}}function n(e){let n={annotations:[],artifacts:[]},l=o(e);for(let a of e.children)if(a.namespaceURI===i&&"g"===a.localName){if(a.classList.contains("annotation")){if(null===l)continue;let e=t(a,l);if(null===e)continue;n.annotations.push(e)}else if(a.classList.contains("artifact")){if(null===l)continue;let e=null;if(a.classList.contains("background"))e="Background";else if(a.classList.contains("layout"))e="Layout";else if(a.classList.contains("page"))e="Page";else{if(!a.classList.contains("pagination"))continue;e="Pagination"}let i=t(a,l);if(null===i)continue;n.artifacts.push({kind:e,annotation:i})}}return n}async function l(){let e=document.getElementById("pdfmcr-page-group");if(null===e)return void alert("cannot save: page group not found");let t=document.querySelector('meta[name="pdfmcr-page-number"]');if(null===t)return void alert("cannot save: page number meta element not found");let l=+t.content,a=new Request(`/page/${l}/annotations`,{method:"POST",body:JSON.stringify(n(e)),headers:{"Content-Type":"application/json"}}),i=!1;try{let e=await fetch(a),t=e.text();200!==e.status?alert("cannot save: "+t):i=!0}catch(e){alert("cannot save: "+await e)}i&&alert("saved!")}function a(){let e=document.getElementById("pdfmcr-save-button");null!==e&&e.addEventListener("click",l)}e.serialize=n,e.init=function(){document.addEventListener("DOMContentLoaded",a)}}(l||(l={}));class s{constructor(e,t){this.key=e,this.value=t}getKey(){return this.key}getValue(){return this.value}}let d=Symbol();class f{constructor(){this.entries=[]}getIndexForKey(e){for(let t=0;t<this.entries.length;t++)if(this.entries[t].getKey()===e)return t;return null}set(e,t){let n=this.getIndexForKey(e);if(null!==n){let e=this.entries[n].getValue();return this.entries[n]=new s(this.entries[n].getKey(),t),e}return this.entries.push(new s(e,t)),d}get(e){let t=this.getIndexForKey(e);return null!==t?this.entries[t].getValue():d}remove(e){let t=this.getIndexForKey(e);return null!==t?this.entries.splice(t,1)[0].getValue():d}length(){return this.entries.length}keys(){let e=[];for(let t=0;t<this.entries.length;t++)e.push(this.entries[t].getKey());return e}}"use strict";!function(e){let t=[],n=new f;function l(){for(let e of document.getElementsByClassName("spl-splitter-container")){for(let t of e.getElementsByClassName("spl-pane"))t.style.flexGrow="1",t.style.flexShrink="1",t.style.flexBasis="auto";for(let l of e.getElementsByClassName("spl-splitter"))l.style.width="8px",l.style.height="100%",l.style.cursor="col-resize",l.style.userSelect="none",l.addEventListener("mousedown",e=>(function(e,l){let a=e.previousElementSibling,i=e.nextElementSibling;if(null===a||null===i)return;n.set(e,{startPosition:{x:l.clientX,y:l.clientY},splitterLeft:e.offsetLeft,splitterTop:e.offsetTop,leftPaneWidth:a.offsetWidth,rightPaneWidth:i.offsetWidth});let u=t=>(function(e,t){let l=n.get(e);if(l===d)return;let a=e.previousElementSibling,i=e.nextElementSibling;if(null===a||null===i)return;let u={x:t.clientX-l.startPosition.x,y:t.clientY-l.startPosition.y};u.x<-l.leftPaneWidth&&(u.x=-l.leftPaneWidth),u.x>l.rightPaneWidth&&(u.x=l.rightPaneWidth),e.style.left=`${l.splitterLeft+u.x}px`,a.style.width=`${l.leftPaneWidth+u.x}px`,i.style.width=`${l.rightPaneWidth-u.x}px`})(e,t);document.addEventListener("mousemove",u),t.push(["mousemove",u]);let o=()=>(function(){let e=t.splice(0,t.length);for(let t=0;t<e.length;t++)document.removeEventListener(e[t][0],e[t][1])})();document.addEventListener("mouseup",o),t.push(["mouseup",o])})(l,e))}}e.init=function(){document.addEventListener("DOMContentLoaded",l)}}(a||(a={})),window.PdfMcr={Annotations:n,Serialize:l,Splitter:a,SvgDrag:e,TextManagement:t,init:function(){window.PdfMcr.Serialize.init(),window.PdfMcr.Splitter.init(),window.PdfMcr.SvgDrag.init(),window.PdfMcr.TextManagement.init()}}})();
//# sourceMappingURL=main.js.map
