(()=>{var e,t,n,l,a;let i="http://www.w3.org/2000/svg";function u(e,t){let n=e.ownerSVGElement;if(null===n)return null;let l=e.transform.baseVal;if(1!==l.length)return null;let a=l.getItem(0);if(a.type!==SVGTransform.SVG_TRANSFORM_TRANSLATE)return null;let i=n.createSVGLength();i.newValueSpecifiedUnits(SVGLength.SVG_LENGTHTYPE_NUMBER,a.matrix.e),i.convertToSpecifiedUnits(t);let u=i.valueInSpecifiedUnits;return i.newValueSpecifiedUnits(SVGLength.SVG_LENGTHTYPE_NUMBER,a.matrix.f),i.convertToSpecifiedUnits(t),{x:u,y:i.valueInSpecifiedUnits}}function o(e){let t=null;for(let n of e.children)if(n.namespaceURI===i&&"image"===n.tagName){t=n;break}return null===t?null:(t.height.baseVal.convertToSpecifiedUnits(SVGLength.SVG_LENGTHTYPE_PT),t.height.baseVal.valueInSpecifiedUnits)}function r(e,t,n){let l=e.children,a=[];for(let e=0;e<l.length;e++){let i=l[e];i.namespaceURI===t&&i.localName===n&&a.push(i)}return a}function c(e){return e.endsWith("pt")?+e.substring(0,e.length-2):null}!function(e){let n=null,l=null,a=null;function u(){if(null===n||null===l)return;let e=r(l,i,"tspan"),t=n.textSpanSelect.selectedIndex;if(null===(a=-1===t||t>=e.length?null:e[t]))return;let u=0,o=c(a.style.lineHeight),s=c(a.style.fontSize)??12;null!==o&&(u=o-s),n.textArea.value=a.textContent??"",n.fontBoldCheckbox.checked="bold"===a.style.fontWeight,n.fontItalicCheckbox.checked="italic"===a.style.fontStyle,n.fontSizeInput.value=""+(c(a.style.fontSize)??12),n.charSpacingInput.value=""+(c(a.style.letterSpacing)??0),n.wordSpacingInput.value=""+(c(a.style.wordSpacing)??0),n.leadingInput.value=""+u,n.languageEnabledCheckbox.checked=a.hasAttribute("data-lang"),n.languageInput.value=a.getAttribute("data-lang")??"",n.altTextEnabledCheckbox.checked=a.hasAttribute("data-alt-text"),n.altTextInput.value=a.getAttribute("data-alt-text")??"",n.actualTextEnabledCheckbox.checked=a.hasAttribute("data-actual-text"),n.actualTextInput.value=a.getAttribute("data-actual-text")??"",n.expansionEnabledCheckbox.checked=a.hasAttribute("data-expansion"),n.expansionTextInput.value=a.getAttribute("data-expansion")??""}function o(){if(null===n||null===l)return;let e=t.createDefaultTextChunk("lorem ipsum");t.makeTSpanFromTextChunk(l,e);let a=document.createElement("option");a.text=e.text,n.textSpanSelect.appendChild(a),n.textSpanSelect.selectedIndex=n.textSpanSelect.options.length-1}function s(){if(null===n||null===l||-1===n.textSpanSelect.selectedIndex)return;let e=r(l,i,"tspan");if(n.textSpanSelect.selectedIndex>=e.length)return;let t=e[n.textSpanSelect.selectedIndex];null!==t.parentElement&&t.parentElement.removeChild(t),n.textSpanSelect.options.remove(n.textSpanSelect.selectedIndex)}function d(){if(null===n||null===a)return;let e=+n.leadingInput.value+ +n.fontSizeInput.value;for(let[t,l,i]of(a.textContent=n.textArea.value,a.style.fontWeight=n.fontBoldCheckbox.checked?"bold":"",a.style.fontStyle=n.fontItalicCheckbox.checked?"italic":"",a.style.fontSize=`${n.fontSizeInput.value}pt`,a.style.letterSpacing=`${n.charSpacingInput.value}pt`,a.style.wordSpacing=`${n.wordSpacingInput.value}pt`,a.style.lineHeight=`${e}pt`,[[n.languageEnabledCheckbox,n.languageInput,"data-lang"],[n.altTextEnabledCheckbox,n.altTextInput,"data-alt-text"],[n.actualTextEnabledCheckbox,n.actualTextInput,"data-actual-text"],[n.expansionEnabledCheckbox,n.expansionTextInput,"data-expansion"]]))t.checked?a.setAttribute(i,l.value):a.removeAttribute(i);-1!==n.textSpanSelect.selectedIndex&&(n.textSpanSelect.options[n.textSpanSelect.selectedIndex].textContent=a.textContent)}function f(){let e=document.getElementById("pdfmcr-edit-label"),t=document.getElementById("pdfmcr-tspan-select"),l=document.getElementById("pdfmcr-textarea"),a=document.getElementById("pdfmcr-font-bold-checkbox"),i=document.getElementById("pdfmcr-font-italic-checkbox"),r=document.getElementById("pdfmcr-font-size"),c=document.getElementById("pdfmcr-char-spacing"),f=document.getElementById("pdfmcr-word-spacing"),p=document.getElementById("pdfmcr-leading"),g=document.getElementById("pdfmcr-lang-enabled"),m=document.getElementById("pdfmcr-lang"),x=document.getElementById("pdfmcr-alt-text-enabled"),h=document.getElementById("pdfmcr-alt-text"),S=document.getElementById("pdfmcr-actual-text-enabled"),y=document.getElementById("pdfmcr-actual-text"),E=document.getElementById("pdfmcr-expansion-enabled"),b=document.getElementById("pdfmcr-expansion");if(null===e||null===t||null===l||null===a||null===i||null===r||null===c||null===f||null===p||null===g||null===m||null===x||null===h||null===S||null===y||null===E||null===b)return;let v=document.getElementById("pdfmcr-add-tspan-button"),T=document.getElementById("pdfmcr-remove-tspan-button"),I=document.getElementById("pdfmcr-update-tspan-button");null!==v&&null!==T&&null!==I&&(n={editLabelSection:e,textSpanSelect:t,textArea:l,fontBoldCheckbox:a,fontItalicCheckbox:i,fontSizeInput:r,charSpacingInput:c,wordSpacingInput:f,leadingInput:p,languageEnabledCheckbox:g,languageInput:m,altTextEnabledCheckbox:x,altTextInput:h,actualTextEnabledCheckbox:S,actualTextInput:y,expansionEnabledCheckbox:E,expansionTextInput:b},t.addEventListener("change",u),v.addEventListener("click",o),T.addEventListener("click",s),I.addEventListener("click",d))}e.textSelected=function(e){if(null!==n){for(l=e;n.textSpanSelect.options.length>0;)n.textSpanSelect.options.remove(n.textSpanSelect.options.length-1);for(let e of r(l,i,"tspan")){let t=document.createElement("option");t.textContent=e.textContent,n.textSpanSelect.appendChild(t)}n.textSpanSelect.selectedIndex=0,u(),n.editLabelSection.style.display=""}},e.textDeselected=function(){null!==n&&(n.editLabelSection.style.display="none",l=null,a=null)},e.init=function(){document.addEventListener("DOMContentLoaded",f)}}(e||(e={})),function(t){let n=null,l=[],a=null;function r(e,t,l){if(null===n)return null;let a=e.ownerSVGElement;if(null===a)return null;let i=a.createSVGTransform();return i.setTranslate(n.x+t,n.y+l),e.transform.baseVal.initialize(i),a}function c(e){return{text:e,font_variant:"Regular",font_size:12,character_spacing:0,word_spacing:0,leading:0,language:null,alternate_text:null,actual_text:null,expansion:null}}function s(e,t){let n=t.font_size+t.leading,l=document.createElementNS(i,"tspan");l.style.fontSize=`${t.font_size}pt`,l.style.letterSpacing=`${t.character_spacing}pt`,l.style.wordSpacing=`${t.word_spacing}pt`,l.style.lineHeight=`${n}pt`,e.appendChild(l),null!==t.language&&l.setAttribute("data-language",t.language),null!==t.alternate_text&&l.setAttribute("data-alternate-text",t.alternate_text),null!==t.actual_text&&l.setAttribute("data-actual-text",t.actual_text),null!==t.expansion&&l.setAttribute("data-expansion",t.expansion);let a=document.createTextNode(t.text);return l.appendChild(a),l}function d(t,o,c){let d=t.ownerSVGElement;if(null===d)return null;let f=d.createSVGLength();f.newValueSpecifiedUnits(SVGLength.SVG_LENGTHTYPE_PT,c.left),f.convertToSpecifiedUnits(SVGLength.SVG_LENGTHTYPE_NUMBER);let p=f.valueInSpecifiedUnits;f.newValueSpecifiedUnits(SVGLength.SVG_LENGTHTYPE_PT,o-c.bottom),f.convertToSpecifiedUnits(SVGLength.SVG_LENGTHTYPE_NUMBER);let g=f.valueInSpecifiedUnits,m=document.createElementNS(i,"g");m.classList.add("annotation");let x=d.createSVGTransform();x.setTranslate(p,g),m.transform.baseVal.initialize(x);let h=document.createElementNS(i,"text");for(let e of(h.style.fill="#000",m.appendChild(h),c.elements))s(h,e);let S=document.createElementNS(i,"rect");return S.x.baseVal.newValueSpecifiedUnits(SVGLength.SVG_LENGTHTYPE_PT,0),S.y.baseVal.newValueSpecifiedUnits(SVGLength.SVG_LENGTHTYPE_PT,0),S.width.baseVal.newValueSpecifiedUnits(SVGLength.SVG_LENGTHTYPE_PT,10),S.height.baseVal.newValueSpecifiedUnits(SVGLength.SVG_LENGTHTYPE_PT,10),S.style.fill="#fff",S.style.fillOpacity="0.5",S.addEventListener("mousedown",t=>(function(t,o,c){if(0!==c.button)return;c.stopPropagation(),null!==a&&(a.style.fill="#fff"),a=t,t.style.fill="#f00";let s=o.getElementsByTagNameNS(i,"text");s.length>0&&e.textSelected(s[0]);let d=o.ownerSVGElement;if(null===d)return;let f=u(o,SVGLength.SVG_LENGTHTYPE_NUMBER);if(null===f)return;n={x:f.x-c.clientX,y:f.y-c.clientY};let p=e=>{r(o,e.clientX,e.clientY)};l.push(["mousemove",p]),d.addEventListener("mousemove",p);let g=e=>(function(e,t){if(0!==t.button)return;let a=r(e,t.clientX,t.clientY);if(null!==a){for(let e of l.splice(0,l.length))a.removeEventListener(e[0],e[1]);n=null}})(o,e);l.push(["mouseup",g]),d.addEventListener("mouseup",g)})(S,m,t)),m.appendChild(S),t.appendChild(m),m}t.createDefaultTextChunk=c,t.makeTSpanFromTextChunk=s,t.init=function(e){void 0===e&&(e={annotations:[],artifacts:[]}),document.addEventListener("DOMContentLoaded",()=>{!function(e){let t=document.getElementById("pdfmcr-page-group");if(null===t)return;let n=o(t);if(null!==n)for(let l of e.annotations)d(t,n,l)}(e),function(){let e=document.getElementById("pdfmcr-new-annotation-form");if(null===e)return;let t=e.querySelector("input[type=text]");null!==t&&e.addEventListener("submit",e=>(function(e,t){t.preventDefault();let n=e.value,l=document.getElementById("pdfmcr-page-group");if(null===l)return;let a=o(l);null!==a&&d(l,a,{left:0,bottom:0,elements:[c(n)]})})(t,e))}()})}}(t||(t={})),function(e){function t(e,t){if(null===e.ownerSVGElement)return null;let n=u(e,SVGLength.SVG_LENGTHTYPE_PT);if(null===n)return null;let l=e.getElementsByTagNameNS(i,"text");if(0===l.length)return null;let a=l[0],o=[];for(let e of a.children){if(e.namespaceURI!==i||"tspan"!==e.localName)continue;let t=c(e.style.fontSize),n=c(e.style.letterSpacing),l=c(e.style.wordSpacing),a=c(e.style.lineHeight),u="bold"===e.style.fontWeight,r="italic"===e.style.fontStyle;if(null===t||null===n||null===l||null===a)continue;let s=a-t,d=e.childNodes;if(1!==d.length||d[0].nodeType!==Node.TEXT_NODE)return null;let f=d[0].textContent;if(null===f)return null;let p=u?r?"BoldItalic":"Bold":r?"Italic":"Regular",g=e.getAttribute("data-lang"),m=e.getAttribute("data-alt-text"),x=e.getAttribute("data-actual-text"),h=e.getAttribute("data-expansion");o.push({text:f,font_variant:p,font_size:Math.round(t),character_spacing:Math.round(n),word_spacing:Math.round(l),leading:Math.round(s),language:g,alternate_text:m,actual_text:x,expansion:h})}return{left:Math.round(n.x),bottom:Math.round(t-n.y),elements:o}}function n(e){let n={annotations:[],artifacts:[]},l=o(e);for(let a of e.children)if(a.namespaceURI===i&&"g"===a.localName){if(a.classList.contains("annotation")){if(null===l)continue;let e=t(a,l);if(null===e)continue;n.annotations.push(e)}else if(a.classList.contains("artifact")){if(null===l)continue;let e=null;if(a.classList.contains("background"))e="Background";else if(a.classList.contains("layout"))e="Layout";else if(a.classList.contains("page"))e="Page";else{if(!a.classList.contains("pagination"))continue;e="Pagination"}let i=t(a,l);if(null===i)continue;n.artifacts.push({kind:e,annotation:i})}}return n}async function l(){let e=document.getElementById("pdfmcr-page-group");if(null===e)return void alert("cannot save: page group not found");let t=document.querySelector('meta[name="pdfmcr-page-number"]');if(null===t)return void alert("cannot save: page number meta element not found");let l=+t.content,a=new Request(`/page/${l}/annotations`,{method:"POST",body:JSON.stringify(n(e)),headers:{"Content-Type":"application/json"}}),i=!1;try{let e=await fetch(a),t=e.text();200!==e.status?alert("cannot save: "+t):i=!0}catch(e){alert("cannot save: "+await e)}i&&alert("saved!")}function a(){let e=document.getElementById("pdfmcr-save-button");null!==e&&e.addEventListener("click",l)}e.serialize=n,e.init=function(){document.addEventListener("DOMContentLoaded",a)}}(n||(n={}));class s{constructor(e,t){this.key=e,this.value=t}getKey(){return this.key}getValue(){return this.value}}let d=Symbol();class f{constructor(){this.entries=[]}getIndexForKey(e){for(let t=0;t<this.entries.length;t++)if(this.entries[t].getKey()===e)return t;return null}set(e,t){let n=this.getIndexForKey(e);if(null!==n){let e=this.entries[n].getValue();return this.entries[n]=new s(this.entries[n].getKey(),t),e}return this.entries.push(new s(e,t)),d}get(e){let t=this.getIndexForKey(e);return null!==t?this.entries[t].getValue():d}remove(e){let t=this.getIndexForKey(e);return null!==t?this.entries.splice(t,1)[0].getValue():d}length(){return this.entries.length}keys(){let e=[];for(let t=0;t<this.entries.length;t++)e.push(this.entries[t].getKey());return e}}"use strict";!function(e){let t=[],n=new f;function l(){for(let e of document.getElementsByClassName("spl-splitter-container")){for(let t of e.getElementsByClassName("spl-pane"))t.style.flexGrow="1",t.style.flexShrink="1",t.style.flexBasis="auto",t.style.overflow="hidden";for(let l of e.getElementsByClassName("spl-splitter"))l.style.width="8px",l.style.height="100%",l.style.cursor="col-resize",l.style.userSelect="none",l.addEventListener("mousedown",e=>(function(e,l){let a=e.previousElementSibling,i=e.nextElementSibling;if(null===a||null===i)return;n.set(e,{startPosition:{x:l.clientX,y:l.clientY},splitterLeft:e.offsetLeft,splitterTop:e.offsetTop,leftPaneWidth:a.offsetWidth,rightPaneWidth:i.offsetWidth});let u=t=>(function(e,t){let l=n.get(e);if(l===d)return;let a=e.previousElementSibling,i=e.nextElementSibling;if(null===a||null===i)return;let u={x:t.clientX-l.startPosition.x,y:t.clientY-l.startPosition.y};u.x<-l.leftPaneWidth&&(u.x=-l.leftPaneWidth),u.x>l.rightPaneWidth&&(u.x=l.rightPaneWidth),e.style.left=`${l.splitterLeft+u.x}px`,a.style.width=`${l.leftPaneWidth+u.x}px`,i.style.width=`${l.rightPaneWidth-u.x}px`})(e,t);document.addEventListener("mousemove",u),t.push(["mousemove",u]);let o=()=>(function(){let e=t.splice(0,t.length);for(let t=0;t<e.length;t++)document.removeEventListener(e[t][0],e[t][1])})();document.addEventListener("mouseup",o),t.push(["mouseup",o])})(l,e))}}e.init=function(){document.addEventListener("DOMContentLoaded",l)}}(l||(l={})),function(e){let t=null,n={x:0,y:0},l=[];function a(e){let t=e.ownerSVGElement;if(null===t)return;let l=t.createSVGTransform();l.setTranslate(n.x,n.y),e.transform.baseVal.initialize(l)}function i(e,t,n){e.addEventListener(t,n),l.push([t,n])}function u(){let e=document.getElementById("pdfmcr-page-group");if(null===e)return;e.addEventListener("mousedown",u=>(function(e,u){if(0!==u.button)return;let o=e.ownerSVGElement;null!==o&&(t={x:u.offsetX-n.x,y:u.offsetY-n.y},i(o,"mousemove",l=>{null!==t&&(n={x:l.clientX-t.x,y:l.clientY-t.y},a(e))}),i(o,"mouseup",a=>(function(e,a){if(0!==a.button||null===t)return;let i=e.ownerSVGElement;if(null!==i)for(let e of(n={x:a.clientX-t.x,y:a.clientY-t.y},t=null,l.splice(0,l.length)))i.removeEventListener(e[0],e[1])})(e,a)))})(e,u));let u=document.getElementById("pdfmcr-reset-view-button");null!==u&&u.addEventListener("click",()=>{n={x:0,y:0},a(e)})}e.init=function(){document.addEventListener("DOMContentLoaded",u)}}(a||(a={})),window.PdfMcr={Annotations:t,Serialize:n,Splitter:l,SvgDrag:a,TextManagement:e,init:function(){window.PdfMcr.Serialize.init(),window.PdfMcr.Splitter.init(),window.PdfMcr.SvgDrag.init(),window.PdfMcr.TextManagement.init()}}})();
//# sourceMappingURL=main.js.map
