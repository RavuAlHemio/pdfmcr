(()=>{var e,t,n,l;let i="http://www.w3.org/2000/svg";function s(e,t){let n=e.ownerSVGElement;if(null===n)return null;let l=e.transform.baseVal;if(1!==l.length)return null;let i=l.getItem(0);if(i.type!==SVGTransform.SVG_TRANSFORM_TRANSLATE)return null;let s=n.createSVGLength();s.newValueSpecifiedUnits(SVGLength.SVG_LENGTHTYPE_NUMBER,i.matrix.m41),s.convertToSpecifiedUnits(t);let o=s.valueInSpecifiedUnits;return s.newValueSpecifiedUnits(SVGLength.SVG_LENGTHTYPE_NUMBER,i.matrix.m42),s.convertToSpecifiedUnits(t),{x:o,y:s.valueInSpecifiedUnits}}!function(e){function t(){!function(){let e=document.getElementById("pdfmcr-new-annotation-form");if(null===e)return;let t=e.querySelector("input[type=text]");null!==t&&e.addEventListener("submit",e=>(function(e,t){t.preventDefault();let n=e.value,l=document.getElementById("pdfmcr-page-group");if(null===l)return;let o=l.ownerSVGElement;if(null===o)return;let r=document.createElementNS(i,"g");r.classList.add("annotation");let a=o.createSVGTransform();a.setTranslate(0,0),r.transform.baseVal.initialize(a),l.appendChild(r);let u=document.createElementNS(i,"rect");u.x.baseVal.newValueSpecifiedUnits(SVGLength.SVG_LENGTHTYPE_PT,0),u.y.baseVal.newValueSpecifiedUnits(SVGLength.SVG_LENGTHTYPE_PT,0),u.width.baseVal.newValueSpecifiedUnits(SVGLength.SVG_LENGTHTYPE_PT,10),u.height.baseVal.newValueSpecifiedUnits(SVGLength.SVG_LENGTHTYPE_PT,10),u.style.fill="#fff",u.style.fillOpacity="0.5",u.addEventListener("mousedown",e=>{e.stopPropagation(),s(r),e.clientX,e.clientY}),r.appendChild(u);let c=document.createElementNS(i,"text");c.style.fill="#000",r.appendChild(c);let f=document.createElementNS(i,"tspan");f.style.fontSize="12pt",f.style.letterSpacing="0pt",f.style.wordSpacing="0pt",f.style.lineHeight="12pt",c.appendChild(f);let d=document.createTextNode(n);f.appendChild(d)})(t,e))}()}e.init=function(){document.addEventListener("DOMContentLoaded",t)}}(e||(e={})),function(e){function t(e){return e.endsWith("pt")?+e.substring(0,e.length-2):null}function n(e,n){if(null===e.ownerSVGElement)return null;let l=s(e,SVGLength.SVG_LENGTHTYPE_PT);if(null===l)return null;let o=e.getElementsByTagNameNS(i,"text");if(0===o.length)return null;let r=o[0],a=[];for(let e of r.children){if(e.namespaceURI!==i||"tspan"!==e.localName)continue;let n=t(e.style.fontSize),l=t(e.style.letterSpacing),s=t(e.style.wordSpacing),o=t(e.style.lineHeight),r="bold"===e.style.fontWeight,u="italic"===e.style.fontStyle;if(null===n||null===l||null===s||null===o)continue;let c=o-n,f=e.childNodes;if(1!==f.length||f[0].nodeType!==Node.TEXT_NODE)return null;let d=f[0].textContent;if(null===d)return null;let g=r?u?"BoldItalic":"Bold":u?"Italic":"Regular";a.push({text:d,font_variant:g,font_size:n,character_spacing:l,word_spacing:s,leading:c,language:null,alternate_text:null,actual_text:null,expansion:null})}return{left:l.x,bottom:n-l.y,elements:a}}function l(e){let t={annotations:[],artifacts:[]};for(let l of e.children)if(l.namespaceURI===i){if("image"===l.localName){let t=l.width.baseVal.value,n=e.ownerSVGElement;if(null===n)continue;let i=n.createSVGLength();i.newValueSpecifiedUnits(SVGLength.SVG_LENGTHTYPE_PX,t),i.convertToSpecifiedUnits(SVGLength.SVG_LENGTHTYPE_PT),i.valueInSpecifiedUnits;continue}if("g"===l.localName){if(l.classList.contains("annotation")){if(null===imageHeight)continue;let e=n(l,imageHeight);if(null===e)continue;t.annotations.push(e)}else if(l.classList.contains("artifact")){if(null===imageHeight)continue;let e=null;if(l.classList.contains("background"))e="Background";else if(l.classList.contains("layout"))e="Layout";else if(l.classList.contains("page"))e="Page";else{if(!l.classList.contains("pagination"))continue;e="Pagination"}let i=n(l,imageHeight);if(null===i)continue;t.artifacts.push({kind:e,annotation:i})}}}return t}async function o(){let e=document.getElementById("pdfmcr-page-group");if(null===e)return void alert("cannot save: page group not found");let t=document.querySelector('meta[name="pdfmcr-page-number"]');if(null===t)return void alert("cannot save: page number meta element not found");let n=+t.content,i=new Request(`/page/${n}/annotations`,{method:"POST",body:JSON.stringify(l(e)),headers:{"Content-Type":"application/json"}});try{let e=await fetch(i),t=e.text();200!==e.status&&alert("cannot save: "+t)}catch(e){alert("cannot save: "+e)}alert("saved!")}function r(){let e=document.getElementById("pdfmcr-save");null!==e&&e.addEventListener("click",o)}e.serialize=l,e.init=function(){document.addEventListener("DOMContentLoaded",r)}}(t||(t={}));class o{constructor(e,t){this.key=e,this.value=t}getKey(){return this.key}getValue(){return this.value}}let r=Symbol();class a{constructor(){this.entries=[]}getIndexForKey(e){for(let t=0;t<this.entries.length;t++)if(this.entries[t].getKey()===e)return t;return null}set(e,t){let n=this.getIndexForKey(e);if(null!==n){let e=this.entries[n].getValue();return this.entries[n]=new o(this.entries[n].getKey(),t),e}return this.entries.push(new o(e,t)),r}get(e){let t=this.getIndexForKey(e);return null!==t?this.entries[t].getValue():r}remove(e){let t=this.getIndexForKey(e);return null!==t?this.entries.splice(t,1)[0].getValue():r}length(){return this.entries.length}keys(){let e=[];for(let t=0;t<this.entries.length;t++)e.push(this.entries[t].getKey());return e}}"use strict";!function(e){let t=[],n=new a;function l(){for(let e of document.getElementsByClassName("spl-splitter-container")){for(let t of e.getElementsByClassName("spl-pane"))t.style.flexGrow="1",t.style.flexShrink="1",t.style.flexBasis="auto",t.style.overflow="hidden";for(let l of e.getElementsByClassName("spl-splitter"))l.style.width="8px",l.style.height="100%",l.style.cursor="col-resize",l.style.userSelect="none",l.addEventListener("mousedown",e=>(function(e,l){let i=e.previousElementSibling,s=e.nextElementSibling;if(null===i||null===s)return;n.set(e,{startPosition:{x:l.clientX,y:l.clientY},splitterLeft:e.offsetLeft,splitterTop:e.offsetTop,leftPaneWidth:i.offsetWidth,rightPaneWidth:s.offsetWidth});let o=t=>(function(e,t){let l=n.get(e);if(l===r)return;let i=e.previousElementSibling,s=e.nextElementSibling;if(null===i||null===s)return;let o={x:t.clientX-l.startPosition.x,y:t.clientY-l.startPosition.y};o.x<-l.leftPaneWidth&&(o.x=-l.leftPaneWidth),o.x>l.rightPaneWidth&&(o.x=l.rightPaneWidth),e.style.left=`${l.splitterLeft+o.x}px`,i.style.width=`${l.leftPaneWidth+o.x}px`,s.style.width=`${l.rightPaneWidth-o.x}px`})(e,t);document.addEventListener("mousemove",o),t.push(["mousemove",o]);let a=()=>(function(){let e=t.splice(0,t.length);for(let t=0;t<e.length;t++)document.removeEventListener(e[t][0],e[t][1])})();document.addEventListener("mouseup",a),t.push(["mouseup",a])})(l,e))}}e.init=function(){document.addEventListener("DOMContentLoaded",l)}}(n||(n={})),function(e){let t=null,n={x:0,y:0},l=[];function i(e){let t=e.ownerSVGElement;if(null===t)return;let l=t.createSVGTransform();l.setTranslate(n.x,n.y),e.transform.baseVal.initialize(l)}function s(e,t,n){e.addEventListener(t,n),l.push([t,n])}function o(){let e=document.getElementById("pdfmcr-page-group");if(null===e)return;e.addEventListener("mousedown",o=>(function(e,o){if(0!==o.button)return;let r=e.ownerSVGElement;null!==r&&(t={x:o.offsetX-n.x,y:o.offsetY-n.y},s(r,"mousemove",l=>{null!==t&&(n={x:l.clientX-t.x,y:l.clientY-t.y},i(e))}),s(r,"mouseup",i=>(function(e,i){if(0!==i.button||null===t)return;let s=e.ownerSVGElement;if(null!==s)for(let e of(n={x:i.clientX-t.x,y:i.clientY-t.y},t=null,l.splice(0,l.length)))s.removeEventListener(e[0],e[1])})(e,i)))})(e,o));let o=document.getElementById("pdfmcr-reset-view");null!==o&&o.addEventListener("click",()=>{n={x:0,y:0},i(e)})}e.init=function(){document.addEventListener("DOMContentLoaded",o)}}(l||(l={})),window.PdfMcr={Annotations:e,Serialize:t,Splitter:n,SvgDrag:l,init:function(){window.PdfMcr.Annotations.init(),window.PdfMcr.Serialize.init(),window.PdfMcr.Splitter.init(),window.PdfMcr.SvgDrag.init()}}})();
//# sourceMappingURL=main.js.map
